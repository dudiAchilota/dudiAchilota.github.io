<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <title>תרגול</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      direction: rtl;
      padding: 20px;
    }
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    .stats {
      font-size: 16px;
      font-weight: bold;
      color: #2c3e50;
    }
    .question {
      margin: 20px 0;
      padding: 15px;
      border: 1px solid #ccc;
      border-radius: 10px;
    }
    .answers label {
      display: block;
      margin: 5px 0;
      cursor: pointer;
    }
    .answers input[type="radio"]:checked + span {
      font-weight: bold;
      color: darkblue;
    }
    .filter-box {
      margin: 20px 0;
      padding: 10px;
      border: 1px solid #aaa;
      border-radius: 8px;
      background: #f9f9f9;
    }
    button {
      padding: 10px 15px;
      border-radius: 6px;
      border: none;
      background: #3498db;
      color: #fff;
      font-size: 14px;
      cursor: pointer;
    }
    button:hover {
      background: #2980b9;
    }
  </style>
</head>

<body>

  <div class="top-bar">
    <h2>מסך תרגול   11</h2>
    <div id="score" class="stats">0/0</div>
  </div>

  <div class="filter-box">
    <h3>סינון לפי סטטיסטיקה</h3>

    <label>
      <input type="checkbox" id="filterAppeared"> סינון לפי כמות פעמים שנענתה שאלה
    </label><br>
    מ־ <input type="number" id="minAppeared" value="1" min="0"> 
    עד <input type="number" id="maxAppeared" value="3" min="0">

    <br><br>

    <label>
      <input type="checkbox" id="filterCorrect"> סינון לפי כמות תשובות נכונות
    </label><br>
    מ־ <input type="number" id="minCorrect" value="1" min="0"> 
    עד <input type="number" id="maxCorrect" value="3" min="0">
  </div>

  <div id="question-container"></div>
  <button onclick="nextQuestion()">שאלה הבאה</button>

  <script>
    // נתוני דוגמה
    const allData = [
      { "מספר שאלה": 1, "שאלה": "מה בירת ישראל?", "תשובה 1": "תל אביב", "תשובה 2": "ירושלים", "תשובה 3": "חיפה", "תשובה נכונה": "ירושלים", "קטגוריה": "גיאוגרפיה" },
      { "מספר שאלה": 2, "שאלה": "מה 2+2?", "תשובה 1": "3", "תשובה 2": "4", "תשובה 3": "5", "תשובה נכונה": "4", "קטגוריה": "חשבון" },
      { "מספר שאלה": 3, "שאלה": "איזה ים נמצא בישראל?", "תשובה 1": "הים התיכון", "תשובה 2": "הים השחור", "תשובה 3": "הים הצהוב", "תשובה נכונה": "הים התיכון", "קטגוריה": "גיאוגרפיה" }
    ];

    let currentQuestion = null;
    let selectedCategories = ["גיאוגרפיה","חשבון"];

    // --- שמירת סטטיסטיקות ---
    function updateStats(questionId, correct) {
      let stats = JSON.parse(localStorage.getItem('questionStats') || '{}');
      if (!stats[questionId]) stats[questionId] = { appeared: 0, correct: 0 };
      stats[questionId].appeared++;
      if (correct) stats[questionId].correct++;
      localStorage.setItem('questionStats', JSON.stringify(stats));
    }

    // --- הצגת שאלה ---
    function displayQuestion() {
      const container = document.getElementById('question-container');
      const stats = JSON.parse(localStorage.getItem('questionStats') || '{}');
      const qStats = stats[currentQuestion["מספר שאלה"]] || { appeared: 0, correct: 0 };

      let html = `
        <div class="question">
          <h3>${currentQuestion["שאלה"]}</h3>
          <div class="answers">
            ${[1,2,3,4].map(i => currentQuestion["תשובה " + i] ? `
              <label>
                <input type="radio" name="answer" value="${currentQuestion["תשובה " + i]}">
                <span>${currentQuestion["תשובה " + i]}</span>
              </label>
            ` : '').join('')}
          </div>
          <button onclick="checkAnswer()">בדוק תשובה</button>
          <div class="stats"> ${qStats.correct}/${qStats.appeared} </div>
        </div>
      `;
      container.innerHTML = html;
      updateScore();
    }

    // --- בדיקת תשובה ---
    function checkAnswer() {
      const selected = document.querySelector('input[name="answer"]:checked');
      if (!selected) {
        alert("בחר תשובה");
        return;
      }
      const correct = selected.value === currentQuestion["תשובה נכונה"];
      updateStats(currentQuestion["מספר שאלה"], correct);
      alert(correct ? "תשובה נכונה!" : "תשובה שגויה!");
      displayQuestion();
    }

    // --- עדכון תצוגת סקור ---
    function updateScore() {
      const stats = JSON.parse(localStorage.getItem('questionStats') || '{}');
      let totalCorrect = 0, totalAppeared = 0;
      Object.values(stats).forEach(s => {
        totalCorrect += s.correct;
        totalAppeared += s.appeared;
      });
      document.getElementById('score').innerText = totalCorrect + "/" + totalAppeared;
    }

    // --- שאלה הבאה עם סינונים ---
    function nextQuestion() {
      const statsData = JSON.parse(localStorage.getItem('questionStats') || '{}');
      const filterAppeared = document.getElementById('filterAppeared')?.checked;
      const filterCorrect = document.getElementById('filterCorrect')?.checked;

      const minAppeared = parseInt(document.getElementById('minAppeared')?.value || '0');
      const maxAppeared = parseInt(document.getElementById('maxAppeared')?.value || '999999');

      const minCorrect = parseInt(document.getElementById('minCorrect')?.value || '0');
      const maxCorrect = parseInt(document.getElementById('maxCorrect')?.value || '999999');

      let pool = allData.filter(q => selectedCategories.includes(q["קטגוריה"]));

      if (filterAppeared) {
        pool = pool.filter(q => {
          const s = statsData[q["מספר שאלה"]] || { appeared: 0 };
          return s.appeared >= minAppeared && s.appeared <= maxAppeared;
        });
      }

      if (filterCorrect) {
        pool = pool.filter(q => {
          const s = statsData[q["מספר שאלה"]] || { correct: 0 };
          return s.correct >= minCorrect && s.correct <= maxCorrect;
        });
      }

      if (pool.length === 0) {
        alert("לא נמצאו שאלות תואמות לסינון");
        return;
      }

      currentQuestion = pool[Math.floor(Math.random() * pool.length)];
      displayQuestion();
    }

    // --- טעינה ראשונית ---
    nextQuestion();
  </script>
</body>

</html>
